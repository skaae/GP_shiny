{
    "contents" : "% !Rnw root = ../master.Rnw\n<<load_kaplan_meier_data,results=hide,echo=False>>=\nsource(\"R_files/ggsurv.R\")\nsource(\"R_files/multiplot.R\")\n\n\n\nvascular.inv <-sample(x=0:1,size=nrow(tab.clinical),replace=TRUE)\nstg <- st.gallen(\n          size        =tab.clinical$size, \n          grade       =tab.clinical$grade, \n          node        =(tab.clinical$node>0)*1, \n          her2.neu    =tab.clinical$her2.combined, \n          age         =tab.clinical$age, \n          vascular.inv=vascular.inv, \n          na.rm = TRUE)\n\n\ntab_stg <- table(stg,useNA=\"always\")\ntab_stg <- t(as.data.frame(as.numeric(tab_stg)))\ncolnames(tab_stg) <- c(\"Good\", \"Intermediate\", \"Poor\",\"Not Available\")\n#colnames(tab_stg)<-tab_stg['stg',]\n#colnames(tab_stg)[4] <- \"Not available\"\n\n#tab_stg <- tab_stg[-1,]\n\nnpi_node <- as.numeric(cut(tab.clinical$node,right=F,\n                           breaks=c(-Inf,1,4,Inf)))\n\ntnpi<-npi(\n  size        =tab.clinical$size, \n  grade       =tab.clinical$grade, \n  node        =as.numeric(npi_node),\n  na.rm = TRUE)\n\ntab_npi <- table(tnpi$risk,useNA=\"always\")\ntab_npi <- t(as.data.frame(as.numeric(tab_npi)))\ncolnames(tab_npi) <- c(\"Good\", \"Intermediate\", \"Poor\",\"Not Available\")\n\n\n\n# note that the survival package uses \"opposite\" indication of right censoring \n# than gpstuff. In gpstuff:\n#         % event indicator, ye = 0 for uncensored event (dead)\n#         % ye = 1 for right censored event (alive)\n# and in survival:\n#        ye = The status indicator, normally 0=alive, 1=dead\n\nfac = as.factor(tab.clinical$grade)\nlab <- paste0(\"a) Grade (n=\",sum(!is.na(tab.clinical$grade)),\")\")\nmfit<- survfit(formula=Surv(t.combined/365,e.combined)~fac, data=tab.clinical)\np1 <- ggsurv(mfit,plot.cens=F,xlab=\"Years\") +\n      guides(linetype = F) + \n      scale_colour_brewer(type=\"qual\",palette=qualSet,name = 'Grade', labels=levels(fac)) +\n      theme(legend.justification=c(0,0), legend.position=c(0,0)) +\n      theme(axis.text.x = element_blank(),axis.title.x = element_blank()) +\n      ylim(0, 1) +\n    annotate(\"text\", 25, 1, label = lab, hjust = 1, size = 7) +\n    theme(axis.title.y = element_text(face=\"bold\", size=15))\n\nfac = as.factor(stg)\nleg_lab <- paste(c(\"Good\",\"Intermediate\",\"Poor\"),levels(fac))\nlab <- paste0(\"c) St. Gallen 2006 score (n=\",sum(!is.na(stg)),\")\")\nmfit<- survfit(formula=Surv(t.combined/365,e.combined)~fac, data=tab.clinical)\np2 <- ggsurv(mfit,plot.cens=F,xlab=\"Years\") +\n      guides(linetype = F) + \n      scale_colour_brewer(type=\"qual\",palette=qualSet,name = 'NPI score', labels=leg_lab) +\n      theme(legend.justification=c(0,0), legend.position=c(0,0)) +\n      ylim(0, 1) +\n      annotate(\"text\", 25, 1, label = lab, hjust = 1, size = 7) +\n      theme(axis.title.x = element_text(face=\"bold\", size=15),\n            axis.title.y = element_text(face=\"bold\", size=15))\n\nfac = cut(tnpi$score, br=c(-Inf,3.39,5.4,Inf))\nleg_lab <- paste(c(\"Good\",\"Intermediate\",\"Poor\"),levels(fac))\nlab <- paste0(\"b) NPI score (n=\",sum(!is.na(tnpi$score)),\")\")\nmfit<- survfit(formula=Surv(t.combined/365,e.combined)~fac, data=tab.clinical)\np3 <- ggsurv(mfit,plot.cens=F,xlab=\"Years\") +\n      guides(linetype = F) + \n      scale_colour_brewer(type=\"qual\",palette=qualSet,name = 'NPI score', labels=leg_lab) +\n      theme(legend.justification=c(0,0), legend.position=c(0,0)) +\n      ylim(0, 1) +\n      annotate(\"text\", 25, 1, label = lab, hjust = 1, size = 7) +\n      theme(axis.title.x = element_text(face=\"bold\", size=15),\n            axis.title.y = element_text(face=\"bold\", size=15))\n\n\nfac <- cut(tab.clinical$size, br=c(-Inf,1.5,2.5,Inf))\nlab <- paste0(\"d) Size cm (n=\",sum(!is.na(tab.clinical$size)),\")\")\nmfit<- survfit(formula=Surv(t.combined/365,e.combined)~fac, data=tab.clinical)\np4 <- ggsurv(mfit,plot.cens=F,xlab=\"Years\") +\n      guides(linetype = F) + \n      scale_colour_brewer(type=\"qual\",palette=qualSet,name = 'Size cm', labels=levels(fac)) +\n      theme(legend.justification=c(0,0), legend.position=c(0,0)) +\n      theme(axis.text.y = element_blank(),axis.title.y = element_blank()) +\n      ylim(0, 1) +\n      annotate(\"text\", 25, 1, label = lab, hjust = 1, size = 7) +\n        theme(axis.title.x = element_text(face=\"bold\", size=15))\n\n\npdf(\"figs/kaplan_p1_p2_p3_p4.pdf\",height=10,width=10)\nmultiplot(p1,p2,p3,p4,cols=2)\ndev.off()\n\nfac = as.factor(tab.clinical$er.combined)\nlab <- paste0(\"a) ER receptor (n=\",sum(!is.na(tab.clinical$er.combined)),\")\")\nmfit<- survfit(formula=Surv(t.combined/365,e.combined)~fac, data=tab.clinical)\np5 <-  ggsurv(mfit,plot.cens=F,xlab=\"Years\")    +\n       guides(linetype = F) + \n       scale_colour_brewer(type=\"qual\",palette=qualSet,name = 'ER status', \n                           labels=levels(fac)) +\n       theme(legend.justification=c(0,0), legend.position=c(0,0)) +\n       ylim(0, 1) +\n     annotate(\"text\", 25, 1, label = lab, hjust = 1, size = 7) +\n  theme(axis.title.x = element_text(face=\"bold\", size=15),\n        axis.title.y = element_text(face=\"bold\", size=15))\n\nfac = as.factor(tab.clinical$her2.combined)\nlab <- paste0(\"c) HER2 receptor (n=\",sum(!is.na(tab.clinical$her2.combined)),\")\")\nmfit<- survfit(formula=Surv(t.combined/365,e.combined)~fac, data=tab.clinical)\np6 <-  ggsurv(mfit,plot.cens=F,xlab=\"Years\")    +\n       guides(linetype = F) + \n       scale_colour_brewer(type=\"qual\",palette=qualSet,name = 'HER2 status', \n                           labels=levels(fac)) +\n       theme(legend.justification=c(0,0), legend.position=c(0,0)) +\n       ylim(0, 1) +\n     annotate(\"text\", 25, 1, label = lab, hjust = 1, size = 7) +\n  theme(axis.title.x = element_text(face=\"bold\", size=15),\n        axis.title.y = element_text(face=\"bold\", size=15))\n\nfac = as.factor(tab.clinical$pgr.combined)\nlab <- paste0(\"b) PR receptor (n=\",sum(!is.na(tab.clinical$pgr.combined)),\")\")\nmfit<- survfit(formula=Surv(t.combined/365,e.combined)~fac, data=tab.clinical)\np7 <-  ggsurv(mfit,plot.cens=F,xlab=\"Years\")    +\n       guides(linetype = F) + \n       scale_colour_brewer(type=\"qual\",palette=qualSet,name = 'PR status', \n                           labels=levels(fac)) +\n       theme(legend.justification=c(0,0), legend.position=c(0,0)) +\n       ylim(0, 1) +\n     annotate(\"text\", 25, 1, label = lab, hjust = 1, size = 7) +\n  theme(axis.title.x = element_text(face=\"bold\", size=15),\n        axis.title.y = element_text(face=\"bold\", size=15))\n\n\nfac = as.factor(tab.clinical$treatment_any)\nlab <- paste0(\"d) Treatment any (n=\",sum(!is.na(tab.clinical$treatment_any)),\")\")\nmfit<- survfit(formula=Surv(t.combined/365,e.combined)~fac, data=tab.clinical)\np8 <-  ggsurv(mfit,plot.cens=F,xlab=\"Years\")    +\n       guides(linetype = F) + \n       scale_colour_brewer(type=\"qual\",palette=qualSet,name = 'Treatment', \n                           labels=levels(fac)) +\n       theme(legend.justification=c(0,0), legend.position=c(0,0)) +\n       ylim(0, 1) +\n     annotate(\"text\", 25, 1, label = lab, hjust = 1, size = 7) +\n  theme(axis.title.x = element_text(face=\"bold\", size=15),\n        axis.title.y = element_text(face=\"bold\", size=15))\n\n\n\npdf(\"figs/kaplan_p5_p6_p7_p8.pdf\",height=10,width=10)\nmultiplot(p5,p6,p7,p8,cols=2)\ndev.off()\n@\n\\subsection{Kaplan Meier} \\FloatBarrier\nFigure \\ref{fig:kaplan_meier1} and Figure \\ref{fig:kaplan_meier2} shows Kaplan-Meier plots with histological grade, \nNPI, ER receptor status and tumor size respectively used for stratification. \nAs expected figure \\ref{fig:kaplan_meier1} shows that increased grade, NPI, \nSt. gallen and tumor size is associated with decreased survival. Figure \n\\ref{fig:kaplan_meier2} shows a slight increase in risk for ER negative and PR\nnegative patients. HER2 positive patients has a slightly higher risk. Receiving\ntreatment is associated with higher risk, probably because patients recieving \ntreatment has more severe cancer.\n\nTable \\ref{tab:npi_stg} shows classification by NPI and St. Gallen. The table shows\nthat both methods clasifies the majority of patients in the intermediate risk groupt. \nThe table also shows that St. gallen rarely classifies patients with good prognosis.\n\\begin{figure}[htbp]\n    \\begin{center}\n        \\includegraphics[width=1.1\\textwidth]{figs/kaplan_p1_p2_p3_p4.pdf}\n    \\end{center}\n    \\caption{Kaplan meier plot of combined data. Panel  \n    a) shows stratification by tumor grade, \n    b) shows stratification by NPI,  \n    c) shows stratification by St. Gallen 2006  \n    d) shows stratification by histological grade.}\n    \\label{fig:kaplan_meier1}\n\\end{figure}\n\n\n\\begin{figure}[htbp]\n    \\begin{center}\n        \\includegraphics[width=1.1\\textwidth]{figs/kaplan_p5_p6_p7_p8.pdf}\n    \\end{center}\n    \\caption{Kaplan meier plot of combined data. Panel  \n    a) shows stratification by ER, \n    b) shows stratification by PR,  \n    c) shows stratification by HER2,  \n    d) shows stratification by Treatment.}\n    \\label{fig:kaplan_meier2}\n\\end{figure}\n\n<<tab_npi,results=tex,echo=FALSE>>=\ntab.npi_stg <- rbind(tab_npi,tab_stg)  \nrownames(tab.npi_stg) <- c(\"NPI\", \"St. Gallen 2006\")\nprint(xtable(tab.npi_stg,\n               digits=0,\n               caption=\"Risk stratificatoin by NPI and St. Gallen 2006\",\n               label=\"tab:npi_stg\"),\n        booktabs=TRUE,\n        caption.placement=\"top\",\n        include.rownames=T)\n@\n\n\n\\FloatBarrier\n\n\n\n",
    "created" : 1387282728215.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "2920161267",
    "id" : "466B7A60",
    "lastKnownWriteTime" : 1387459834,
    "path" : "~/Documents/Speciale/breast_cancer/documents/results_kaplan_meier.Rnw",
    "project_path" : null,
    "properties" : {
    },
    "source_on_save" : false,
    "type" : "sweave"
}